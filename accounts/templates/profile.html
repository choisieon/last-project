{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <meta charset="UTF-8" />
  <title>마이페이지 - 인생 보드게임</title>
  <style>
    @font-face {
      font-family: 'MyCustomFont';
      src: url("{% static 'fonts/픽셀.woff2' %}") format('woff2');
      font-weight: 400;
      font-style: normal;
    }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'MyCustomFont', sans-serif;
      background: url("{% static 'images/Frame 13.png' %}") no-repeat center center fixed;
      background-size: 105%;
    }
    .write-btn {
      background-color: #007aff;
    }
    .write-btn:hover {
      background: #005bb5;
      color: #fff700;

    }
    .login-info {
      background-color: rgba(250, 235, 180, 0.9);
      background-image: url("{% static 'images/pixel-paper.png' %}");
      background-size: 4px 4px;
      background-repeat: repeat;
      padding: 6px 12px;
      border: 2.5px solid #5a4a2f;
      box-shadow: 3px 3px 0 #b9a782;
      font-size: 14px;
      color: #3c2e1e;
      font-weight: bold;
      display: flex;
      align-items: center;
    }

    h1 {
      text-align: center;
      color: #4e3b2b;
    }

    .main-wrapper {
      max-width: 1320px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

.top-section {
  display: flex;
  justify-content: space-between;
  gap: 24px;
  align-items: flex-start;
}
    .profile-box {
      background-color: #f3f3f3;
      border: 4px solid #444;
      border-radius: 8px;
      padding: 16px;
      box-shadow: inset 0 0 0 4px #c2a178;
      width: 750px;
      min-height: 150px;
      position: relative;
    }

    .profile-upper {
      display: flex;
    }

    .left-profile {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 160px;
    }

    .avatar-wrapper {
      border: 4px solid #444;
      background: white;
      padding: 4px;
      border-radius: 8px;
      margin-bottom: 6px;
      width: 140px;
      height: 140px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .avatar-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .nickname-box {
      margin-top: 4px;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      width: 140px;
      background: #bde0fe;
      border: 2px solid #444;
      border-radius: 4px;
      padding: 6px 0;
    }
    .custom-menu {
  position: absolute;
  background: white;
  border: 2px solid #444;
  padding: 8px;
  border-radius: 6px;
  box-shadow: 2px 2px 0 #aaa;
  z-index: 999;
}

    .right-profile {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding-left: 10px;
    }

    .action-buttons {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .action-buttons button {
      background-color: #ffc107;
      border: 3px solid #444;
      border-radius: 6px;
      font-family: 'MyCustomFont';
      padding: 6px 10px;
      font-weight: bold;
      font-size: 13px;
      cursor: pointer;
    }

    .info-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .info-row {
      display: flex;
    }

    .info-label {
      width: 70px;
      background-color: #444;
      color: white;
      padding: 6px;
      font-size: 13px;
      font-weight: bold;
      border-radius: 4px 0 0 4px;
    }

    .info-value {
      flex: 1;
      background: white;
      padding: 6px;
      font-size: 13px;
      border: 2px solid #444;
      border-left: none;
      border-radius: 0 4px 4px 0;
      display: flex;
      align-items: center;
    }

    .policy-box {
      background-color: #f3f3f3;
      border: 4px solid #444;
      border-radius: 8px;
      padding: 16px;
      box-shadow: inset 0 0 0 4px #c2a178;
      width: 700px;
      font-family: 'MyCustomFont';
      font-size: 13px;
    }
    .profile-box,
.policy-box,
.admin-extra-wrapper {
  flex: 1;
  max-width: 32%;
}

    .policy-box select,
    .policy-box button {
      background-color: #8ecae6;
      border: 2px solid #444;
      border-radius: 6px;
      padding: 5px 12px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      font-family: 'MyCustomFont';
      margin-top: 10px;
    }
.admin-wrapper {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 420px;
}
.admin-extra-wrapper {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 420px;
}

.admin-box,
.extra-box {
  background-color: #f3f3f3;
  border: 4px solid #444;
  border-radius: 8px;
  padding: 16px;
  box-shadow: inset 0 0 0 4px #c2a178;
  font-family: 'MyCustomFont';
  font-size: 13px;
}

.profile-section {
  display: flex;
  flex-direction: column;
  flex: 1;
  max-width: 32%;
}

.edit-button-container {
  display: flex;
  justify-content: flex-end;
  margin-top: 4px;
}

.edit-button {
  background-color: #90e0ef;
  border: 3px solid #444;
  border-radius: 6px;
  padding: 6px 14px;
  font-size: 13px;
  font-family: 'MyCustomFont';
  font-weight: bold;
  cursor: pointer;
  box-shadow: 2px 2px 0 #444;
}
.title-box {
  background-color: #f3f3f3;
  border: 4px solid #444;
  box-shadow: inset 0 0 0 4px #c2a178;
  border-radius: 12px;
  padding: 20px 40px;
  width: fit-content;
  margin: 0 auto 24px auto; /* 가운데 정렬 + 아래 여백 */
  font-family: 'MyCustomFont';
}

.title-box h1 {
  margin: 0;
  font-size: 28px;
  text-align: center;
  color: #2f2f2f;
}
.section-title-box {
  background-color: #fffef9;
  border: 3px solid #444;
  box-shadow: inset 0 0 0 3px #c2a178;
  border-radius: 8px;
  padding: 10px 20px;
  width: fit-content;
  margin: 0 0 10px 24px;  /* 왼쪽 정렬 + 여백 (좌측 24px) */
  font-family: 'MyCustomFont';
}


.section-title-box h2 {
  margin: 0;
  font-size: 18px;
  text-align: center;
  color: #333;
}

.delete-button {
  background-color: #ff6b6b;
  color: white;
  border: 2px solid #444;
  font-family: 'MyCustomFont';
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
}

.board-section {
  border: 4px solid #444;
  padding: 16px;
  border-radius: 12px;
  background-color: #fffef9;
  box-shadow: inset 0 0 0 4px #c2a178;
  width: 100%; /* ✅ 바뀐 부분 */
  margin-top: 20px;
  font-family: 'MyCustomFont';
  box-sizing: border-box; /* ✅ 패딩 포함 너비 계산 */
}

.tile {
  width: 160px;
  background-color: #fff;
  border: 3px solid #444;
  border-radius: 10px;
  padding: 10px;
  font-family: 'MyCustomFont';
  font-size: 12px;
  position: relative;
  box-shadow: 2px 2px 0 #aaa;
  transition: transform 0.2s ease;
}

.tile:hover {
  transform: scale(1.03);
}

.tile-header {
  font-weight: bold;
  margin-bottom: 6px;
  background-color: #ffd6a5;
  padding: 4px;
  border-radius: 4px;
  text-align: center;
}


.tile-content {
  margin-bottom: 6px;
}

.tile-detail {
  font-size: 11px;
  color: #444;
  background: #f9f9f9;
  padding: 4px;
  border-radius: 4px;
  margin-top: 6px;
}

.journey-tile:hover {
  transform: scale(1.05);
}

.life-journey {
  position: relative;
}
.life-journey-line {
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: 0;
}
.life-event {
  position: relative;
  z-index: 1;
}


.metrics {
  font-size: 11px;
  color: #555;
}

/* Base container styling */
.life-journey-wrapper {
  overflow-x: auto;           /* Enable horizontal scrolling if needed */
  overflow-y: hidden;
  padding: 10px;
  /* (optional) background-color or other styling */
}

/* Timeline inner container */
.life-journey {
  position: relative;
  display: flex;
  flex-wrap: nowrap;
  align-items: flex-start;    /* align items to top by default */
  width: max-content;        /* Expand width to accommodate all tiles (so scroll works) */
  min-height: 250px;         /* Enough height to accommodate wave amplitude */
  padding: 20px 0;
}

/* Individual event tile container */
.life-event {
  position: relative;        /* positioning context for tooltip */
  flex: 0 0 auto;            /* do not flex-grow, keep natural width */
  margin-right: 60px;        /* spacing between tiles */
}

/* Tile styling with pixel-art style border */
.life-event-tile {
  background: #f9f9f9;
  color: #333;
  padding: 10px;
  width: 140px;
  /* Pixel-art style 3D border (using simple two-tone effect) */
  border: 4px solid #000;
  box-shadow: 4px 4px 0 #000;  /* shadow to give a blocky outline effect */
  position: relative;
  /* Optional: use a pixelated corner image via border-image for true pixel art corners */
  /* border-image: url("/static/img/pixel-border.png") 8 fill / 8px repeat; */
}
.life-event-title {
  margin: 0 0 5px;
  font-size: 1em;
  text-align: center;
}
.life-event-date {
  font-size: 0.9em;
  display: block;
  text-align: center;
  color: #555;
}

/* Position the tiles in a repeating wave (top, mid, bottom, mid, ...) */
.life-event:nth-child(4n+1) { margin-top: 0; }
.life-event:nth-child(4n+2) { margin-top: 80px; }
.life-event:nth-child(4n+3) { margin-top: 160px; }
.life-event:nth-child(4n+4) { margin-top: 80px; }

/* Tooltip styling */
.life-event-tooltip {
  display: none;
  position: absolute;
  left: 50%;
  bottom: -50px;
  transform: translateX(-50%);
  min-width: 150px;
  background: #333;
  color: #fff;
  padding: 8px;
  font-size: 0.9em;
  border: 2px solid #000;
  box-shadow: 2px 2px 0 #000;
  pointer-events: none;  /* tooltip doesn't block pointer, so parent hover still works */
  z-index: 100;
}
/* Show tooltip on tile hover */
.life-event:hover .life-event-tooltip {
  display: block;
}
.life-journey {
  position: relative;  /* SVG가 겹치게 만들기 위해 필요 */
}
.life-event {
  z-index: 1;  /* SVG보다 위에 나오도록 */
}
.menu-left, .menu-right {
  display: flex;
  gap: 12px;
  align-items: center;
}

.menu-box {
  background-color: rgba(250, 235, 180, 0.9);
  background-image: url("{% static 'images/pixel-paper.png' %}");
  background-size: 4px 4px;
  background-repeat: repeat;
  border: 2.5px solid #5a4a2f;
  box-shadow: 3px 3px 0 #b9a782;
  padding: 6px 12px;
  font-weight: bold;
  color: #3c2e1e;
  font-size: 14px;
  text-decoration: none;
}

.menu-box.active {
  color: #007aff;
  font-weight: bold;
}

.top-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 16px;
  margin-bottom: 20px;
}
  </style>
</head>
<body>
 <div class="wrapper">
    <!-- 상단 네비게이션 -->
    <div class="top-nav">
      <div class="menu-left">

        <a href="{% url 'community:index' %}" class="menu-box home-link">
          <i class="fas fa-home"></i>
        </a>
        <a href="{% url 'board:post_list' %}" class="menu-box {% block nav_community_active %}{% endblock %}">커뮤니티</a>
        <a href="{% url 'mentor:mentor_home' %}" class="menu-box {% block nav_mentor_active %}{% endblock %}">멘토멘티</a>
        <a href="#" class="menu-box {% block nav_mypage_active %}{% endblock %}">마이페이지</a>
        <a href="#" class="menu-box {% block nav_policy_active %}{% endblock %}">청년정책</a>
      </div>

    <div class="menu-right">
 
    {% if user.is_authenticated %}
        <div class="login-info">{{user.username}}님 환영합니다</div>
    {% else %}
    
    <!-- <div class="login-info">{{user.username}}님 환영합니다</div> -->
    <a href="{% url 'accounts:login' %}" class="write-btn">로그인</a>
    {% endif %}
  </div>
    </div>
 
  <div class="main-wrapper">
    <div class="top-section">
      <div class="profile-box">
        <div class="profile-upper">
          <div class="left-profile">
            <div class="avatar-wrapper">
              {% if profile.avatar_image %}
                <img src="{{ profile.avatar_image.url }}" alt="아바타">
              {% elif profile.avatar_url %}
                <img src="{{ profile.avatar_url }}" alt="아바타">
              {% else %}
                <span>아바타 없음</span>
              {% endif %}
            </div>
            <div class="nickname-box">{{ profile.nickname|default:"닉네임 없음" }}</div>
          </div>
          <div class="right-profile">
            <div class="action-buttons">
              <button class="mentor-button">멘토 신청</button>
              <button class="review-button">후기</button>
              <button class="recommend-button">추천</button>
            </div>
            <div class="info-group">
              <div class="info-row"><div class="info-label">직업</div><div class="info-value">{{ profile.job|default:"없음" }}</div></div>
              <div class="info-row"><div class="info-label">나이</div><div class="info-value">{{ profile.age|default:"없음" }}</div></div>
              <div class="info-row"><div class="info-label">내공</div><div class="info-value">{{ profile.points|default:"00점" }}</div></div>
              <div class="info-row"><div class="info-label">관심</div><div class="info-value">{{ profile.interests|default:"-" }}</div></div>
              <div class="info-row"><div class="info-label">한줄 소개</div><div class="info-value">{{ profile.tagline|default:"-" }}</div></div>
            </div>
          </div>
      </div>
  <div class="edit-button-container">
    <a href="{% url 'accounts:profile_edit' %}">
      <button class="edit-button">수정하기</button>
    </a>
  </div>
</div>

  

      <div class="policy-box">
        <h3>📌 청년 정책 추천</h3>
        <ul>
          <li>🔍 지역과 관심사를 선택하면 맞춤 정책을 보여드려요</li>
          <li>예: <strong>서울 청년 월세 지원</strong> - 최대 20만원</li>
          <li>예: <strong>취업성공 패키지</strong> - 맞춤형 취업 지원</li>
        </ul>
        <form method="GET" action="#">
          <label for="region">지역 선택</label><br>
          <select name="region" id="region">
            <option value="">-- 선택 --</option>
            <option value="seoul">서울</option>
            <option value="busan">부산</option>
            <option value="etc">그 외 지역</option>
          </select><br><br>

          <label for="interest">관심사 선택</label><br>
          <select name="interest" id="interest">
            <option value="">-- 선택 --</option>
            <option value="job">취업</option>
            <option value="housing">주거</option>
            <option value="finance">금융지원</option>
          </select><br><br>
          
        </form>
        
      </div>
      
  <div class="admin-extra-wrapper">
    <div class="admin-box">
      <h3>👩‍💼 관리자 추천</h3>
      <p style="font-size: 13px;">- 매주 갱신되는 추천 콘텐츠<br>- 신뢰도 높은 정보만 선별!</p>
    </div>
    <div class="extra-box">
      <h3>🎯 새로운 콘텐츠</h3>
      <p style="font-size: 13px;">- 커뮤니티 인기 게시물<br>- 이번 주 추천 활동!</p>
    </div>
  </div>
</div>
<div class="board-section">
  <h2 class="section-title-box">🌪️ 인생여정</h2>
  <div class="life-journey-wrapper">
    <div class="life-journey smooth-line">
      {% for event in life_events %}
        <div class="life-event">
          <div class="life-event-tile">
            <h4 class="life-event-title">{{ event.title }}</h4>
            <span class="life-event-date">{{ event.date }}</span>
          </div>
          <div class="life-event-tooltip">
            <strong>{{ event.title }}</strong><br>
            {{ event.description }}
          </div>
        </div>
      {% endfor %}
      <svg class="life-journey-line" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>
  </div>
</div>
<!-- 커스텀 우클릭 메뉴 -->
<div id="customMenu" class="custom-menu" style="display:none;">
  <form id="deleteForm" method="POST">
    {% csrf_token %}
    <button type="submit" class="delete-button">🗑️ 삭제하기</button>
  </form>
</div>

    <div class="form-section">
      <h3>➕ 새로운 인생 이벤트 추가하기</h3>
      <form action="{% url 'accounts:add_life_event' %}" method="post">
        {% csrf_token %}
        <input type="text" name="date" placeholder="예: 2025년 4월" required />
        <input type="text" name="title" placeholder="이벤트 제목" required />
        <input type="text" name="note" placeholder="간단 메모" />
        <input type="text" name="feeling" placeholder="기분점수" />
        <input type="text" name="score" placeholder="성과점수" />
        <textarea name="detail" placeholder="상세 내용" rows="2"></textarea>
        <button type="submit">이벤트 추가하기</button>
      </form>
    </div>
  </div>
  <script>
  document.addEventListener("click", function () {
    document.getElementById("customMenu").style.display = "none";
  });

  function showDeleteMenu(e, eventId) {
    e.preventDefault(); // 기본 우클릭 메뉴 막기

    const menu = document.getElementById("customMenu");
    menu.style.top = e.pageY + "px";
    menu.style.left = e.pageX + "px";
    menu.style.display = "block";

    // 삭제 form 경로 업데이트
    const form = document.getElementById("deleteForm");
    form.action = `/accounts/life_event/delete/${eventId}/`;
  }
</script>
<script>
(function () {
  const svg = document.querySelector('.life-journey-line');
  const journey = document.querySelector('.life-journey');
  const events = document.querySelectorAll('.life-event');
  if (!svg || events.length < 2) return;

  const svgWidth = journey.scrollWidth;
  const svgHeight = journey.offsetHeight;
  svg.setAttribute('width', svgWidth);
  svg.setAttribute('height', svgHeight);
  svg.style.position = 'absolute';
  svg.style.top = '0';
  svg.style.left = '0';
  svg.innerHTML = '';

  const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  let d = '';

  const baseLeft = journey.getBoundingClientRect().left;
  const baseTop = journey.getBoundingClientRect().top;

  for (let i = 0; i < events.length - 1; i++) {
    const currRect = events[i].getBoundingClientRect();
    const nextRect = events[i + 1].getBoundingClientRect();

    const currX = currRect.left - baseLeft + currRect.width / 2;
    const currY = currRect.top - baseTop + currRect.height / 2;

    const nextX = nextRect.left - baseLeft + nextRect.width / 2;
    const nextY = nextRect.top - baseTop + nextRect.height / 2;

    if (i === 0) {
      d += `M ${currX},${currY} `;
    }

    // 곡선을 원의 1/4 느낌으로 조정
    const curveOffset = 40; // 조절 가능

    const controlX1 = currX + curveOffset;
    const controlY1 = currY;

    const controlX2 = nextX - curveOffset;
    const controlY2 = nextY;

    d += `C ${controlX1},${controlY1} ${controlX2},${controlY2} ${nextX},${nextY} `;
  }

  path.setAttribute('d', d);
  path.setAttribute('fill', 'none');
  path.setAttribute('stroke', '#000');
  path.setAttribute('stroke-width', '3');
  path.setAttribute('stroke-linecap', 'round');

  svg.appendChild(path);
})();
</script>
</body>
</html>