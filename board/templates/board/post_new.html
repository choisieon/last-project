{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="form-outer">
  <div class="form-container">
    <h2>글쓰기</h2>
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-group">
        {{ form.title.label_tag }}
        {{ form.title }}
        {% for error in form.title.errors %}
          <div class="error">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.category.label_tag }}
        {{ form.category }}
        {% for error in form.category.errors %}
          <div class="error">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.content.label_tag }}
        <div id="content_field">
          {{ form.content }}
        </div>
      </div>
      <div class="form-group" id="image_field">
        {{ form.images.label_tag }}
        {{ form.images }}
      </div>
      <button type="submit" class="write-btn">등록</button>
    </form>
  </div>
</div>

<!-- Self-hosted TinyMCE 스크립트 -->
<script src="{% static 'tinymce/js/tinymce/tinymce.min.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const categorySelect = document.getElementById('id_category');
  let tinymceLoaded = false;

  function enableTinyMCE() {
    if (tinymceLoaded) return;
    tinymce.init({
      selector: '#id_content',
      plugins: 'image',
      toolbar: 'undo redo | formatselect | bold italic | alignleft aligncenter alignright | image link',
      menubar: false,
      language: 'ko_KR',
      images_upload_url: '/board/upload-image/', // 이미지 업로드 구현 필요
      automatic_uploads: true,
    });
    tinymceLoaded = true;
  }

  function disableTinyMCE() {
    if (!tinymceLoaded) return;
    tinymce.remove('#id_content');
    tinymceLoaded = false;
  }

  categorySelect.addEventListener('change', function() {
    if (this.value === 'review') {
      enableTinyMCE();
      document.getElementById('image_field').style.display = 'none';
    } else {
      disableTinyMCE();
      document.getElementById('image_field').style.display = 'block';
    }
  });

  // 페이지 로드 시 초기 상태 반영
  if (categorySelect.value === 'review') {
    enableTinyMCE();
    document.getElementById('image_field').style.display = 'none';
  }
});
</script>
{% endblock %}

{% block extra_style %}
<style>
.form-outer {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  padding-top: 40px;
}

.form-container {
  width: 480px;
  background: rgba(255,255,255,0.95);
  border: 2.5px solid #5a4a2f;
  box-shadow: 4px 4px 0 #b9a782;
  border-radius: 14px;
  padding: 36px 32px 28px 32px;
}

.form-group {
  margin-bottom: 22px;
}

.form-group label {
  display: block;
  color: #222;
  font-weight: bold;
  font-size: 1.12rem;
  margin-bottom: 7px;
  text-shadow: 1px 1px 3px #fff, 0 0 2px #0008;
}

.form-control {
  width: 100%;
  border: 2px solid #1976d2;
  border-radius: 7px;
  padding: 13px 14px;
  font-size: 1.09rem;
  background: #fffbe9;
  color: #222831;
  box-shadow: 2px 2px 0 #b9a78233;
  margin-bottom: 13px;
}

.form-control:focus {
  border: 2px solid #007aff;
  background: #fff;
  outline: none;
  box-shadow: 0 0 8px #007aff33;
}

.write-btn {
  background-color: #007aff;
    color: white;
    padding: 6px 12px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
    border: 2px solid #5a4a2f;
    box-shadow: 3px 3px 0 #b9a782;
}

.write-btn:hover {
  background: #005bb5;
  color: #fff700;
}

.error {
  color: #d32f2f;
  font-size: 0.97rem;
  margin-top: 2px;
  margin-bottom: 4px;
}
</style>
{% endblock %}
